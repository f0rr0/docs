---
title: Developing with Prisma Migrate
metaDescription: Learn how to add Prisma Migrate (Preview) to an existing project.
tocDepth: 2
---

<TopBlock>

</TopBlock>

## Creating a schema

```prisma
generator client {
  provider        = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id      Int      @id @default(autoincrement())
  name    String
  posts   Post[]
  profile Profile?
}

model Profile {
  id       Int    @id @default(autoincrement())
  biograpy String
  userId   Int
  user     User   @relation(fields: userId, references: id)
}

model Post {
  id         Int        @id @default(autoincrement())
  title      String
  published  Boolean    @default(true)
  content    String
  authorId   Int
  author     User       @relation(fields: [authorId], references: [id])
  categories Category[]
}

model Category {
  id    Int    @id @default(autoincrement())
  name  String
  posts Post[]

  @@unique([name])
}
```

### Defining native type mappings

```prisma highlight=5;normal;
// ...

model Post {
  id         Int        @id @default(autoincrement())
  title      String     @db.VarChar(200)
  published  Boolean    @default(true)
  content    String
  authorId   Int
  author     User       @relation(fields: [authorId], references: [id])
  categories Category[]
}

// ...
```

## Configure shadow database

## Initializing migrations

```terminal
npm prisma migrate dev
```

<CodeWithResult>
<Cmd>
</Cmd>
<CmdResult>

```
√ Name of migration ... first-migration
The following migration(s) have been created and applied from new schema changes:

migrations/
  └─ 20210305110829_first_migration/
    └─ migration.sql
```

</CmdResult>
</CodeWithResult>

## Writing a seed script

You should expect to reset your database

## Common scenarios

### Renaming a field

By default, renaming a field in the schema results in a `CREATE` and `DROP` in the migration SQL. To rename a field, you need to modify the generated migration SQL before applying it to the database.

```prisma highlight=3;normal;
model Profile {
  id       Int    @id @default(autoincrement())
  biograpy String
  userId   Int
  user     User   @relation(fields: userId, references: id)
}
```

To rename the `biograpy` field to `biography`:

1. Rename the field in the schema:

   ```prisma highlight=3;delete|4;add;
   model Profile {
     id        Int    @id @default(autoincrement())
     biograpy  String
     biography String
     userId    Int
     user      User   @relation(fields: userId, references: id)
   }
   ```

1. Run the following command to create a **draft migration** that you can edit before applying to the database:

   ```terminal
   npx prisma migrate dev --name rename-migration --create-only
   ```

1. Edit the draft migration as shown, changing `DROP` / `DELETE` to a single `RENAME COLUMN`:

      <TabbedContent tabs={[<FileWithIcon text="Before" icon="code"/>, <FileWithIcon text="After" icon="code" />]}>

      <tab>

      ```sql file=./prisma/migrations/20210308092620_rename_migration/migration.sql
      ALTER TABLE "Profile" DROP COLUMN "biograpy",
      ADD COLUMN  "biography" TEXT NOT NULL;
      ```

      </tab>

      <tab>

      ```sql file=./prisma/migrations/20210308092620_rename_migration/migration.sql
      ALTER TABLE "Profile"
      RENAME COLUMN "biograpy" TO "biography"
      ```
      </tab>

      </TabbedContent>

1. Save and apply the migration:

   ```terminal
   npx prisma migrate dev
   ```

### Changing the direction of a 1-1 relation

To change the direction of a 1-1 relation:

1. Make the change in the schema:

   ```prisma
   model User {
    id      Int      @id @default(autoincrement())
    name    String
    posts   Post[]
    profile Profile?
    profileId  @relation(fields: profileId, references: id)
   }

    model Profile {
    id Int @id @default(autoincrement())
    biography String
    user User
    }
    ```

1. Run the following command to create a **draft migration** that you can edit before applying to the database:

    <CodeWithResult expanded={true}>
    <Cmd>

      ```terminal
      npx prisma migrate dev --name rename-migration --create-only
      ```

    </Cmd>
    <CmdResult>

      ```
      ⚠️  There will be data loss when applying the migration:

      • The migration will add a unique constraint covering the columns `[profileId]` on the table `User`. If there are existing duplicate values, the migration will fail.
      ```

    </CmdResult>
    </CodeWithResult>

1. Edit the draft migration as shown:

      <TabbedContent tabs={[<FileWithIcon text="Before" icon="code"/>, <FileWithIcon text="After" icon="code"/>]}>

      <tab>

      ```sql
      -- DropForeignKey
      ALTER TABLE "Profile" DROP CONSTRAINT "Profile_userId_fkey";

        -- DropIndex
      DROP INDEX "Profile_userId_unique";

      -- AlterTable
      ALTER TABLE "Profile" DROP COLUMN "userId";

      -- AlterTable
      ALTER TABLE "User" ADD COLUMN     "profileId" INTEGER NOT NULL;

      -- CreateIndex
      CREATE UNIQUE INDEX "User_profileId_unique" ON "User"("profileId");

      -- AddForeignKey
      ALTER TABLE "User" ADD FOREIGN KEY ("profileId") REFERENCES "Profile"("id") ON DELETE CASCADE ON UPDATE CASCADE;
      ```

      </tab>

      <tab>

      ```sql
      -- DropForeignKey
      ALTER TABLE "Profile" DROP CONSTRAINT "Profile_userId_fkey";

      -- DropIndex
      DROP INDEX "Profile_userId_unique";

      -- AlterTable
      ALTER TABLE "User" ADD COLUMN "profileId" INTEGER;

      UPDATE "User"
      SET "profileId" = "Profile".id
      FROM "Profile"
      WHERE "User".id = "Profile"."userId";

      ALTER TABLE "User" ALTER COLUMN "profileId" SET NOT NULL;

      -- AlterTable
      ALTER TABLE "Profile" DROP COLUMN "userId";

      -- CreateIndex
      CREATE UNIQUE INDEX "User_profileId_unique" ON "User"("profileId");

      -- AddForeignKey
      ALTER TABLE "User" ADD FOREIGN KEY ("profileId") REFERENCES "Profile"("id") ON DELETE CASCADE ON UPDATE CASCADE;
      ```

      </tab>

      </TabbedContent>

### Populating new required fields with data from existing records

For example, changing name to mandatory `firstName` and `lastName` fields:

## Managing migration files in source control

Folders to add:

* `./prisma/migrations/*`
